<ion-header>
  <ion-toolbar>
    <ion-title>Détails</ion-title>
  </ion-toolbar>
  </ion-header>

<ion-content *ngIf="annonce as a; else loadingTpl">
  <div class="photos" *ngIf="a.photos?.length">
    <div class="photos-row">
      <img *ngFor="let p of a.photos" [src]="p" alt="photo" />
    </div>
  </div>

  <ion-card>
    <ion-card-header>
      <ion-card-title>{{ a.title }}</ion-card-title>
      <ion-card-subtitle>
        {{ a.price_per_month }} {{ a.currency || 'TND' }} / mois
      </ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <p>{{ a.description }}</p>

      <ion-list lines="none">
        <ion-item>
          <ion-label>
            <strong>Chambres:</strong> {{ a.bedrooms || 0 }}
          </ion-label>
          <ion-label class="ion-text-right">
            <strong>Sdb:</strong> {{ a.bathrooms || 0 }}
          </ion-label>
        </ion-item>
        <ion-item>
          <ion-label>
            <strong>Adresse:</strong>
            {{ a.address?.street || '' }}
            {{ a.address?.city || '' }}
            {{ a.address?.postal_code || '' }}
            {{ a.address?.country || '' }}
          </ion-label>
        </ion-item>
        <ion-item *ngIf="a.location">
          <ion-label>
            <strong>Coordonnées:</strong>
            <span>{{ a.location?.latitude || a.location?.lat }}, {{ a.location?.longitude || a.location?.lng }}</span>
          </ion-label>
        </ion-item>
        <ion-item *ngIf="a.contact as contact">
          <ion-label>
            <strong>Contact:</strong> {{ contact.email }} | {{ contact.phone }}
          </ion-label>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>Réserver</ion-card-title>
      <ion-card-subtitle>Choisissez une période</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <ion-item>
        <ion-label>Début</ion-label>
        <ion-datetime
          presentation="date"
          [(ngModel)]="startDate"
          (ionChange)="onDatesChanged()"
        ></ion-datetime>
      </ion-item>
      <ion-item>
        <ion-label>Fin</ion-label>
        <ion-datetime
          presentation="date"
          [(ngModel)]="endDate"
          (ionChange)="onDatesChanged()"
        ></ion-datetime>
      </ion-item>
      <div class="summary">
        <div>Mois estimés: <strong>{{ estimatedMonths }}</strong></div>
        <div>Total: <strong>{{ totalPrice }} {{ a.currency || 'TND' }}</strong></div>
      </div>

      <ion-button expand="block" color="primary" (click)="requestReservation()" [disabled]="!startDate || !endDate || estimatedMonths <= 0">
        Demander la réservation
      </ion-button>
    </ion-card-content>
  </ion-card>
</ion-content>

<ng-template #loadingTpl>
  <ion-content>
    <ion-spinner name="crescent" class="center-spinner"></ion-spinner>
  </ion-content>
</ng-template>
