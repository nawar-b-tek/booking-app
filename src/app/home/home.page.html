<ion-content class="background-image">
  <section class="hero-section">
    <div class="hero-content">
      <h1 class="hero-title">Vacation rentals in Tunisia</h1>
      <p class="hero-subtitle">Find your ideal accommodation among our best offers</p>

      <form class="search-card" (ngSubmit)="applyFilters()" novalidate>
        <div class="search-fields">
          <label class="search-field">
            <ion-icon name="location-outline"></ion-icon>
            <div>
              <span class="field-label">Destination</span>
              <input
                type="text"
                name="destination"
                [(ngModel)]="filters.destination"
                placeholder="Où allez-vous ?"
                autocomplete="off"
              />
            </div>
          </label>

          <label class="search-field">
            <ion-icon name="bed-outline"></ion-icon>
            <div>
              <span class="field-label">Chambres minimum</span>
              <input
                type="number"
                name="rooms"
                min="1"
                [(ngModel)]="filters.rooms"
                placeholder="1"
                inputmode="numeric"
              />
            </div>
          </label>
        </div>

        <ion-button expand="block" class="search-button" type="submit">
          <ion-icon slot="start" name="search-outline"></ion-icon>
          Rechercher
        </ion-button>
      </form>
    </div>
  </section>

  <section class="annonces-section">
    <div class="section-header">
      <h2>Latest Listings</h2>
      <p>Discover our available properties</p>
    </div>

    <ion-list lines="none" class="annonces-list">
      <ion-item *ngIf="errorMessage" color="danger">
        <ion-icon slot="start" name="warning-outline"></ion-icon>
        <ion-label>{{ errorMessage }}</ion-label>
      </ion-item>

      <ng-container *ngIf="filteredAnnonces$ | async as annonces; else loading">
        <ion-card
          *ngFor="let annonce of annonces"
          [routerLink]="['/annonces', annonce.id]"
          class="annonce-card"
        >
          <div class="card-image" *ngIf="annonce.photos?.length">
            <img [src]="annonce.photos?.[0] ?? ''" alt="Photo de la propriété" />

            <div class="card-status" *ngIf="annonce.isBooked">
              <ion-icon name="checkmark-circle"></ion-icon>
              Réservé
            </div>

            <div class="card-badge" *ngIf="annonce.price_per_day || annonce.price">
              {{ annonce.price_per_day || annonce.price }} {{ annonce.currency || 'TND' }} / jour
            </div>
          </div>

          <ion-card-content>
            <h3>{{ annonce.title || 'Annonce sans titre' }}</h3>

            <p class="location" *ngIf="annonce.address?.city || annonce.address?.country">
              <ion-icon name="location-outline"></ion-icon>
              <span>
                {{ annonce.address?.city }}{{ annonce.address?.city && annonce.address?.country ? ', ' : '' }}{{ annonce.address?.country }}
              </span>
            </p>

            <p class="description" *ngIf="annonce.description">
              {{ annonce.description }}
            </p>

            <div class="card-footer" *ngIf="annonce.bedrooms || annonce.bathrooms">
              <span *ngIf="annonce.bedrooms">
                <ion-icon name="bed-outline"></ion-icon>
                {{ annonce.bedrooms }} {{ annonce.bedrooms > 1 ? 'chambres' : 'chambre' }}
              </span>
              <span *ngIf="annonce.bathrooms">
                <ion-icon name="water-outline"></ion-icon>
                {{ annonce.bathrooms }} {{ annonce.bathrooms > 1 ? 'salles de bain' : 'salle de bain' }}
              </span>
            </div>
          </ion-card-content>
        </ion-card>

        <ion-card *ngIf="!annonces || !annonces.length" class="empty-card">
          <ion-card-content>
            <ion-icon name="home-outline"></ion-icon>
            <p>Aucune annonce ne correspond à votre recherche.</p>
          </ion-card-content>
        </ion-card>
      </ng-container>
    </ion-list>
  </section>

  <ng-template #loading>
    <div class="loading-container">
      <ion-spinner name="crescent" color="primary"></ion-spinner>
      <p>Chargement des annonces...</p>
    </div>
  </ng-template>
</ion-content>
